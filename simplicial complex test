import numpy as np
import galois



GF = galois.GF(2)



vertices = [0, 1, 2, 3]



edges = [
    (0, 1),
    (1, 2),
    (2, 3),
    (3, 0),
    (0, 2)
]



#uncomment to fill triangle
faces = [
    # (0, 1, 2),
    # (0, 2, 3)
]



def boundary_1(vertices, edges):
    m = len(vertices)
    n = len(edges)
    B1 = GF.Zeros((m, n))

    for j, (v1, v2) in enumerate(edges):
        B1[v1, j] = 1
        B1[v2, j] = 1

    return B1



def boundary_2(edges, faces):
    m = len(edges)
    n = len(faces)
    B2 = GF.Zeros((m, n))

    edge_index = {e: i for i, e in enumerate(edges)}
    edge_index.update({(b, a): i for (a, b), i in edge_index.items()})

    for j, face in enumerate(faces):
        a, b, c = face
        for e in [(a, b), (b, c), (a, c)]:
            B2[edge_index[e], j] = 1

    return B2



B1 = boundary_1(vertices, edges)
B2 = boundary_2(edges, faces)



def rank(M):
    if M.size == 0:
        return 0
    return np.linalg.matrix_rank(M.view(np.ndarray))



def homology_dimension(B1, B2):
    dim_kernel_B1 = B1.shape[1] - rank(B1)
    dim_image_B2 = rank(B2)
    return dim_kernel_B1 - dim_image_B2



H1_dim = homology_dimension(B1, B2)

print("Boundary matrix ∂1:")
print(B1)

print("\nBoundary matrix ∂2:")
print(B2)

print(f"\nDimension of H1: {H1_dim}")

if H1_dim > 0:
    print("complex has a hole")
else:
    print("complex has no hole")





# visual of simplicial complex

import matplotlib.pyplot as plt
from matplotlib.patches import Polygon



def visualize_simplicial_complex(vertices, edges, faces):
    coords = {
        0: (0, 0),
        1: (1, 0),
        2: (1, 1),
        3: (0, 1)
    }

    fig, ax = plt.subplots(figsize=(5, 5))

    for face in faces:
        points = [coords[v] for v in face]
        polygon = Polygon(points, alpha=0.3)
        ax.add_patch(polygon)

    for i, j in edges:
        x = [coords[i][0], coords[j][0]]
        y = [coords[i][1], coords[j][1]]
        ax.plot(x, y, linewidth=2)

    for v in vertices:
        x, y = coords[v]
        ax.scatter(x, y, s=100, zorder=3)
        ax.text(x + 0.03, y + 0.03, str(v), fontsize=12)

    ax.set_axis_off()

    plt.show()



visualize_simplicial_complex(vertices, edges, faces)
